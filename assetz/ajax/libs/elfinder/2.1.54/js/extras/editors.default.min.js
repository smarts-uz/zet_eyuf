!function(e,t){if("function"==typeof define&&define.amd)define(["elfinder"],e);else if(t){var i=t.prototype._options.commandsOptions.edit.editors;t.prototype._options.commandsOptions.edit.editors=i.concat(e(t))}}(function(e){"use strict";function h(e,t,i){var n=(a=a||t.arrayFlip(D))[e]||t.mimeTypes[e];return i?"jpg"===n&&(n="jpeg"):"jpeg"===n&&(n="jpg"),n}function v(e,t){var i=$.Deferred();try{var n=document.createElement("canvas"),o=n.getContext("2d"),a=new Image;return a.src=e,$(a).on("load",function(){try{n.width=a.width,n.height=a.height,o.drawImage(a,0,0),((e=n.toDataURL(t).match(/^data:([a-z0-9]+\/[a-z0-9.+-]+)/i))?e[1]:"").toLowerCase()===t.toLowerCase()?i.resolve(n.toDataURL(t),n):i.reject()}catch(e){i.reject()}var e}).on("error",function(){i.reject()}),i}catch(e){return i.reject()}}function o(e,t,i,n){function o(){r.attr("id",e+"-img").attr("src",a||i).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",function(e){return r.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button").prop("disabled",!e)[e?"removeClass":"addClass"]("ui-state-disabled"),r.css("opacity",e?"":"0.3"),s[e?"hide":"show"](),r})}var a,r=$(this).children("img:first").data("ext",h(t.mime,n)),s=$('<div class="elfinder-edit-spinner elfinder-edit-image"/>').html('<span class="elfinder-spinner-text">'+n.i18n("ntfloadimg")+'</span><span class="elfinder-spinner"/>').hide().appendTo(this);i.match(/^data:/)?o():n.openUrl(t.hash,!1,function(e){a=e,r.attr("_src",i),o()})}var a,t=window.location.search.match(/getfile=([a-z]+)/),u=e.prototype.hasRequire,s=function(){var t;try{t=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){t=!!(void 0===window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return t}(),D={bmp:"image/x-ms-bmp",dng:"image/x-adobe-dng",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",ppm:"image/x-portable-pixmap",psd:"image/vnd.adobe.photoshop",pxd:"image/x-pixlr-data",svg:"image/svg+xml",tiff:"image/tiff",webp:"image/webp",xcf:"image/x-xcf",sketch:"application/x-sketch",ico:"image/x-icon",dds:"image/vnd-ms.dds",emf:"application/x-msmetafile"};return function(){if(s&&window.parent!==window){var e,t,i,n,o,a=window.location.search.match(/[?&]pixlr=([^&]+)/),r=window.location.search.match(/[?&]image=([^&]+)/);a&&(t=(e=window.parent).$("#"+a[1]+"iframe").hide(),n=e.$("#"+a[1]).data("resizeoff")(),"http"===r[1].substr(0,4)?(o=(i=r[1]).replace(/.+\.([^.]+)$/,"$1"),n.data("ext")!==o&&n.closest(".ui-dialog").trigger("changeType",{extention:o,mime:D[o]}),"https:"===window.location.protocol&&(i=i.replace(/^http:/,"https:")),n.on("load error",function(){n.data("loading")(!0)}).attr("src",i).data("loading")()):n.data("loading")(!0),t.trigger("destroy").remove())}}(),t&&"ckeditor"===(t=t[1])&&(e.prototype._options.getFileCallback=function(e,t){var i,n;window.opener.CKEDITOR.tools.callFunction((i=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),(n=window.location.search.match(i))&&1<n.length?n[1]:""),t.convAbsUrl(e.url)),t.destroy(),window.close()}),[{info:{id:"tuiimgedit",name:"TUI Image Editor",iconImg:"img/editor-icons.png 0 -48",dataScheme:!0,schemeContent:!0,openMaximized:!0,canMakeEmpty:!1,integrate:{title:"TOAST UI Image Editor",link:"http://ui.toast.com/tui-image-editor/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><canvas></canvas></div>',setup:function(e,t){t.UA.ltIE8||t.UA.Mobile?this.disabled=!0:(this.opts=Object.assign({version:"v3.9.0"},e.extraOptions.tuiImgEditOpts||{},{iconsPath:t.baseUrl+"img/tui-",theme:{}}),t.isSameOrigin(this.opts.iconsPath)||(this.disabled=!0,t.debug("warning","Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.")))},init:function(e,t,i,n){this.data("url",i)},load:function(v){function t(e){var t,i,n,s,o=$(v),a=o.parent(),r=b.confObj.opts,c=r.iconsPath,d=$('<div class="tui-image-editor-container">').appendTo(a),l=[$('<div class="tui-image-editor-submenu"/>').appendTo(d),$('<div class="tui-image-editor-controls"/>').appendTo(d)],p=new e(v,{includeUI:{loadImage:{path:o.data("url"),name:b.file.name},theme:Object.assign(r.theme,{"menu.normalIcon.path":c+"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":c+"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":c+"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":c+"icon-c.svg","menu.hoverIcon.name":"icon-c","submenu.normalIcon.path":c+"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":c+"icon-c.svg","submenu.activeIcon.name":"icon-c"}),initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:Math.max(300,a.width()),cssMaxHeight:Math.max(200,a.height()-(l[0].height()+l[1].height()+3)),usageStatistics:!1}),m=o.find("canvas:first").get(0),f=function(e){if(void 0!==e){var t,i,n=$(m),o=parseInt(n.attr("width")),a=parseInt(n.attr("height")),r=o/a;0===e?(t=o,i=a):(i=(t=parseInt(n.css("max-width"))+Number(e))/r,o<t&&a<i&&(t=o,i=a)),h.text(Math.round(t/o*100)+"%"),p.resizeCanvasDimension({width:t,height:i}),s&&setTimeout(function(){s&&f(e)},50)}},u=$('<span class="ui-icon ui-icon-plusthick"/>').data("val",10),g=$('<span class="ui-icon ui-icon-minusthick"/>').data("val",-10),h=$("<button/>").css("width","4em").text("%").attr("title","100%").data("val",0);d.remove(),o.removeData("url").data("mime",b.file.mime),"image/jpeg"===b.file.mime?(o.data("quality",x.storage("jpgQuality")||x.option("jpgQuality")),t=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=t.val();o.data("quality",e),i&&cancelAnimationFrame(i),i=requestAnimationFrame(function(){m.toBlob(function(e){e&&t.next("span").text(" ("+x.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(o.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(x.i18n("quality")+" : "),t,$("<span/>")).prependTo(o.parent().next())):"image/svg+xml"===b.file.mime&&o.closest(".ui-dialog").trigger("changeType",{extention:"png",mime:"image/png",keepEditor:!0}),$('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(g,h,u).attr("title",x.i18n("scale")).on("click","span,button",function(){f($(this).data("val"))}).on("mousedown mouseup mouseleave","span",function(e){s=!1,n&&clearTimeout(n),"mousedown"===e.type&&(n=setTimeout(function(){s=!0,f($(e.target).data("val"))},500))}).prependTo(o.parent().next()),setTimeout(function(){y.resolve(p),t&&(t.trigger("change"),p.on("redoStackChanged undoStackChanged",function(){t.trigger("change")})),f(null)},100),o.find(".tui-colorpicker-palette-container").on("click",".tui-colorpicker-palette-preview",function(){$(this).closest(".color-picker-control").height("auto").find(".tui-colorpicker-slider-container").toggle()}),o.on("click",function(){o.find(".tui-colorpicker-slider-container").hide()})}var i,b=this,x=this.fm,y=$.Deferred(),e=x.options.cdns,n=b.confObj.opts.version;return b.confObj.editor?t(b.confObj.editor):(i=$.Deferred(),x.loadCss([e.tui+"/tui-color-picker/latest/tui-color-picker.css",e.tui+"/tui-image-editor/"+n+"/tui-image-editor.css"]),x.hasRequire?(require.config({paths:{"fabric/dist/fabric.require":e.fabric+"/fabric.require.min",fabric:e.fabric+"/fabric.min","tui-code-snippet":e.tui+"/tui.code-snippet/latest/tui-code-snippet.min","tui-color-picker":e.tui+"/tui-color-picker/latest/tui-color-picker.min","tui-image-editor":e.tui+"/tui-image-editor/"+n+"/tui-image-editor.min"}}),require(["tui-image-editor"],function(e){i.resolve(e)})):x.loadScript([e.fabric+"/fabric.min.js",e.tui+"/tui.code-snippet/latest/tui-code-snippet.min.js"],function(){x.loadScript([e.tui+"/tui-color-picker/latest/tui-color-picker.min.js"],function(){x.loadScript([e.tui+"/tui-image-editor/"+n+"/tui-image-editor.min.js"],function(){i.resolve(window.tui.ImageEditor)},{loadType:"tag"})},{loadType:"tag"})},{loadType:"tag"}),i.done(function(e){b.confObj.editor=e,t(e)})),y},getContent:function(e){var t=this.editor,i=t.fm,n=$(e),o=n.data("quality");if(t.instance)return"image/jpeg"===n.data("mime")&&(o=o||i.storage("jpgQuality")||i.option("jpgQuality"),o=Math.max(.1,Math.min(1,o/100))),t.instance.toDataURL({format:h(n.data("mime"),i,!0),quality:o})},save:function(e){var t,i=$(e),n=i.data("quality"),o=i.data("hash");this.instance.deactivateAll(),void 0!==n&&this.fm.storage("jpgQuality",n),o&&(t=this.fm.file(o),i.data("mime",t.mime))}},{info:{id:"pixlreditor",name:"Pixlr Editor",iconImg:"img/editor-icons.png 0 -128",urlAsContent:!0,schemeContent:!0,single:!0,canMakeEmpty:!0,integrate:{title:"PIXLR EDITOR",link:"https://pixlr.com/editor/"}},mimes:["image/jpeg","image/png","image/gif","image/x-ms-bmp","image/x-pixlr-data"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(e,t){(function(e,t){s&&!t.UA.ltIE8||(this.disabled=!0)}).call(this,e,t)},init:function(e,t,i,n){o.call(this,e,t,0<t.size?n.convAbsUrl(i):"",n)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){(function(n,o){if(!navigator||navigator.mimeTypes["application/x-shockwave-flash"]){var a,r=this,s=this.fm,c=s.res("class","preventback"),d=$(o).children("img:first").data("loading")().data("resizeoff",function(){return $(window).off("resize."+d.attr("id")),l.addClass(c),d}).on("click",function(){e()}),l=$(o).closest(".ui-dialog"),p=s.getUI(),t=s.getUI("toast"),m=$('<iframe class="ui-front" allowtransparency="true">'),f=this.file,u=function(e){e?(m.trigger("destroy").remove(),d.data("loading")(!0),s.error(e)):(t.appendTo(l.closest(".ui-dialog")),s.toast({mode:"info",msg:"Can not launch Pixlr yet. Waiting 15 seconds.",button:{text:"Abort",click:function(){m.trigger("destroy").remove(),d.data("loading")(!0)}},onHidden:function(){1===t.children().length&&t.appendTo(s.getUI())}}),a=setTimeout(e,15e3))},e=function(){var e="https://pixlr.com/"+n+"/?s=c",t=window.location.href.toString().replace(/#.*$/,""),i={};a=setTimeout(u,15e3),t+=(-1===t.indexOf("?")?"?":"&")+"pixlr="+d.attr("id"),e+="&referrer=elFinder&locktitle=true",e+="&exit="+encodeURIComponent(t+"&image=0"),e+="&target="+encodeURIComponent(t),e+="&title="+encodeURIComponent(f.name),e+="&image="+encodeURIComponent(d.attr("_src")),i.src=e,i.css={width:"100%",height:$(window).height()+"px",position:"fixed",display:"block",backgroundColor:"transparent",border:"none",top:0,right:0},r.trigger("Prepare",{node:o,editorObj:void 0,instance:m,opts:i}),m.attr("id",d.attr("id")+"iframe").attr("src",i.src).css(i.css).one("load",function(){a&&clearTimeout(a),setTimeout(function(){m.is(":hidden")&&u("Please disable your ad blocker.")},1e3),l.addClass(c),s.toggleMaximize(m,!0),s.toFront(m)}).on("destroy",function(){s.toggleMaximize(m,!1)}).on("error",u).appendTo(p.hasClass("elfinder-fullscreen")?p:"body")};$(o).on("saveAsFail",e),e()}else{var i="data:application/x-shockwave-flash;base64,Q1dTCJUCAAB42kxSTW/TQBB9Xjv1hkLamoIvEeJaQBUHjvQjVEUKImnkIK7BjTapi5u1dlfQ/gJ6KjdLCHHl9/CPyszaRexhdt/sm3kzs3uJ+A+QVsCTAEfillZ3DbQmAZmD3jZZOk1ms0k+/5wvld0d5cUKt71QMOv6Nx7De2bLUp/mJZbKfVTGFnoFq9zbMrdnd3jBAOrSKbMi5nF7GK5oX+RzhXlelqiMdtpdVQoXnHd6ZZ26oKsqPy3KwhXK4kub8ClsRS7s4gXONZGPjdEGyhhgMJ0qNzG6ohKWFrWARD9Jfgm8CxgEfe+6kdxtuINXqLuIGUSBFNm3ACKt1xEJGcbcqox8QGfMds3bOEuJhpM6QgQpxwSCtAHdmy0eXLQDYb8uMq0dNlHHjYDEIVHD1AeS2L8afuK7ROcTXjJmhXtec92r3R/f1SQfxPw6VFovqzvwoL1MIDc8lpv/cSh6q+1IkGv/hyAJ9iacP8Lz9zVdDmk2iXc/HL3mbZuJMXwQnp3UG42UiII4ZIlHeykOwjd0vO4TY/RhMD2ajQbDMdxZYZtv4d/QT5pHlbaTj5tMUvj+wizFIcG/AAAA//8DAFw0fxk=";$(o).empty().append('<object data="'+i+'" type="application/x-shockwave-flash" style="width:100%;height:100%"><param name="movie" value="'+i+'"></object>')}}).call(this,"editor",e)},save:function(e){},close:function(e){}},{info:{id:"photopea",name:"Photopea",iconImg:"img/editor-icons.png 0 -160",single:!0,noContent:!0,arrayBufferContent:!0,openMaximized:!0,canMakeEmpty:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/webp","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch","image/x-icon","image/vnd-ms.dds"],integrate:{title:"Photopea",link:"https://www.photopea.com/learn/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/x-adobe-dng","image/webp","image/x-xcf","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch","image/x-icon","image/vnd-ms.dds","application/x-msmetafile"],html:'<iframe style="width:100%;height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.IE||t.UA.Mobile)&&(this.disabled=!0)},init:function(e,t,i,c){function d(e){var t=h(e,c),i=D[t];return r.mimesFlip[i]?"jpeg"===t&&(t="jpg"):t="",t&&m[i]||(i=D[t="psd"],a.closest(".ui-dialog").trigger("changeType",{extention:t,mime:i,keepEditor:!0})),t}var n,o,l="https://www.photopea.com",a=$(this).hide().on("load",function(){a.show()}).on("error",function(){s.remove(),a.show()}),p=this.editor,r=p.confObj,s=$('<div class="elfinder-edit-spinner elfinder-edit-photopea"/>').html('<span class="elfinder-spinner-text">'+c.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(a.parent()),m=c.arrayFlip(r.info.canMakeEmpty),f=t.mime;r.mimesFlip||(r.mimesFlip=c.arrayFlip(r.mimes,!0)),r.liveMsg||(r.liveMsg=function(i,e,t){var n,o=i.get(0).contentWindow,a=0,r=null,s=$.Deferred().done(function(){e.remove(),a=1,o.postMessage(r,l)});this.load=function(){return c.getContents(t.hash,"arraybuffer").done(function(e){r=e})},this.receive=function(e){var t=e.originalEvent;t.origin===l&&t.source===o&&("done"===t.data?0===a?s.resolve():1===a?(a=2,i.trigger("contentsloaded")):n&&"pending"===n.state()&&n.reject("errDataEmpty"):"Save"===t.data?p.doSave():n&&"pending"===n.state()&&("object"==typeof t.data?n.resolve("data:"+f+";base64,"+c.arrayBufferToBase64(t.data)):n.reject("errDataEmpty")))},this.getContent=function(){var e,t;if(1<a)return n&&"pending"===n.state()&&n.reject(),n=null,n=$.Deferred(),2===a?(a=3,n.resolve("data:"+f+";base64,"+c.arrayBufferToBase64(r)),r=null):(i.data("mime")&&(f=i.data("mime"),e=d(f)),(t=i.data("quality"))&&(e+=":"+t/100),o.postMessage('app.activeDocument.saveToOE("'+e+'")',l)),n}}),a.parent().css("padding",0),d(t.mime),n=p.liveMsg=new r.liveMsg(a,s,t),$(window).on("message."+c.namespace,n.receive),n.load().done(function(){var e=JSON.stringify({files:[],environment:{lang:c.lang.replace(/_/g,"-"),customIO:{save:'app.echoToOE("Save");'}}});a.attr("src",l+"/#"+encodeURI(e))}).fail(function(e){e&&c.error(e),p.initFail=!0}),"image/jpeg"!==t.mime&&"image/webp"!==t.mime||(a.data("quality",c.storage("jpgQuality")||c.option("jpgQuality")),o=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=o.val();a.data("quality",e)}).val(a.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(c.i18n("quality")+" : "),o,$("<span/>")).prependTo(a.parent().next()))},load:function(e){var t=$.Deferred(),i=this,n=(this.fm,$(e));return i.initFail?t.reject():n.on("contentsloaded",function(){t.resolve(i.liveMsg)}),t},getContent:function(){return this.editor.liveMsg?this.editor.liveMsg.getContent():void 0},save:function(e,t){var i,n=$(e),o=n.data("quality"),a=n.data("hash");void 0!==o&&this.fm.storage("jpgQuality",o),a?(i=this.fm.file(a),n.data("mime",i.mime)):n.removeData("mime")},close:function(e,t){$(e).attr("src",""),t&&$(window).off("message."+this.fm.namespace,t.receive)}},{info:{id:"pixo",name:"Pixo Editor",iconImg:"img/editor-icons.png 0 -208",dataScheme:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"Pixo Editor",link:"https://pixoeditor.com/privacy-policy/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(e,t){!t.UA.ltIE8&&e.extraOptions&&e.extraOptions.pixo&&e.extraOptions.pixo.apikey?this.editorOpts=e.extraOptions.pixo:this.disabled=!0},init:function(e,t,i,n){o.call(this,e,t,i,n)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(a){function e(e){var t;u.length?u.appendTo(u.parent()):(u=$('<div id="elfinder-pixo-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"hidden"}).hide().appendTo(o.hasClass("elfinder-fullscreen")?o:"body"),o.on("resize."+l.namespace,function(e,t){e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&u.appendTo("on"===t.fullscreen?o:"body")}),l.bind("destroy",function(){i&&i.cancelEditing(),u.remove()})),p.on("click",g),t=Object.assign({type:"child",parent:u.get(0),output:{format:"png"},onSave:function(e){function i(e){p.one("load error",function(){p.data("loading")&&p.data("loading")(!0)}).attr("crossorigin","anonymous").attr("src",e)}var t=e.toBlob().type,n=h(t,l),o=e.toDataURL();p.data("loading")(),delete a._canvas,p.data("ext")!==n?v(o,d.file.mime).done(function(e,t){t&&(a._canvas=c=t,s.trigger("change"),r&&r.show()),i(e)}).fail(function(){m.trigger("changeType",{extention:n,mime:t}),i(o)}):i(o)},onClose:function(){m.removeClass(l.res("class","preventback")),l.toggleMaximize(u,!1),u.hide(),l.toFront(m)}},d.confObj.editorOpts),d.trigger("Prepare",{node:a,editorObj:Pixo,instance:void 0,opts:t}),i=new Pixo.Bridge(t),f.resolve(i),n.on("saveAsFail",g),e&&e()}var r,s,t,c,i,d=this,l=this.fm,n=$(a),p=n.children("img:first"),m=n.closest(".ui-dialog"),o=l.getUI(),f=$.Deferred(),u=$("#elfinder-pixo-container"),g=function(){m.addClass(l.res("class","preventback")),l.toggleMaximize(u,!0),l.toFront(u),u.show().data("curhash",d.file.hash),i.edit(p.get(0)),p.data("loading")(!0)};return p.data("loading")(),"image/jpeg"===d.file.mime&&(s=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=s.val();t&&cancelAnimationFrame(t),t=requestAnimationFrame(function(){c&&c.toBlob(function(e){e&&s.next("span").text(" ("+l.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(l.storage("jpgQuality")||l.option("jpgQuality")),r=$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').hide().append($("<span>").html(l.i18n("quality")+" : "),s,$("<span/>")).prependTo(n.parent().next()),n.data("quty",s)),"undefined"==typeof Pixo?l.loadScript(["https://pixoeditor.com:8443/editor/scripts/bridge.m.js"],function(){e(g)},{loadType:"tag"}):(e(),g()),f},save:function(e){var t,i=$(e),n=i.children("img:first");e._canvas?(i.data("quty")&&(t=i.data("quty").val())&&this.fm.storage("jpgQuality",t),n.attr("src",e._canvas.toDataURL(this.file.mime,t?Math.max(Math.min(t,100),1)/100:void 0))):"data:"!==n.attr("src").substr(0,5)&&n.attr("src",function(t,e){var i,n,o,a=t.attr("style");try{t.attr("style",""),i=t.get(0),(n=document.createElement("canvas")).width=i.width,n.height=i.height,t.attr("style",a),n.getContext("2d").drawImage(i,0,0),o=n.toDataURL(e)}catch(e){o=t.attr("src")}return o}(n,this.file.mime))},close:function(e,t){t&&t.destroy()}},{setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/editor-icons.png 0 -96"},load:function(c){var d=this,e=this.fm,l=$.Deferred(),p=e.options.cdns.ace;return d.confObj.loader||(d.confObj.loader=$.Deferred(),d.fm.loadScript([p+"/ace.js"],function(){d.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),d.confObj.loader.done(function(){var e,t,i,n=$(c),o=n.parent(),a=o.parent(),r=c.id+"_ace",s=(d.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});o.height(o.height()),ace.config.set("basePath",p),t=$('<div id="'+r+'" style="width:100%; height:100%;"/>').text(n.val()).insertBefore(n.hide()),n.data("ace",!0),(e=ace.edit(r)).$blockScrolling=1/0,e.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){"text"===(i=ace.require("ace/ext/modelist").getModeForPath("/"+d.file.name).name)&&s[d.file.mime]&&(i=s[d.file.mime]),o.prev().children(".elfinder-dialog-title").append(" ("+d.file.mime+" : "+i.split(/[\/\\]/).pop()+")"),e.setOptions({mode:"ace/mode/"+i}),"resolved"===l.state()&&a.trigger("resize")}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),e.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(e)}),e.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){d.doSave()}}),e.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){d.doCancel()}}),e.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(d.fm.i18n("TextArea")).button().on("click",function(){n.data("ace")?(n.removeData("ace"),t.hide(),n.val(e.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(n.data("ace",!0),t.show(),e.setValue(n.hide().val(),-1),e.focus(),$(this).html(d.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){e.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().appendTo($("#elfinder"))})).prependTo(o.next()),d.trigger("Prepare",{node:c,editorObj:ace,instance:e,opts:{}}),l.resolve(e)}),l},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,i,n){t&&t.resize()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.codemirror||(this.disabled=!0)},info:{id:"codemirror",name:"CodeMirror",iconImg:"img/editor-icons.png 0 -176"},load:function(l){var e=this.fm,p=e.convAbsUrl(e.options.cdns.codemirror),m=$.Deferred(),f=this;return f.confObj.loader||(f.confObj.loader=$.Deferred(),u?(require.config({packages:[{name:"codemirror",location:p,main:"codemirror.min"}],map:{codemirror:{"codemirror/lib/codemirror":"codemirror"}}}),require(["codemirror","codemirror/addon/mode/loadmode.min","codemirror/mode/meta.min"],function(e){f.confObj.loader.resolve(e)})):f.fm.loadScript([p+"/codemirror.min.js"],function(){f.fm.loadScript([p+"/addon/mode/loadmode.min.js",p+"/mode/meta.min.js"],function(){f.confObj.loader.resolve(CodeMirror)})},{loadType:"tag"}),f.fm.loadCss(p+"/codemirror.css")),f.confObj.loader.done(function(e){var t,i,n,o,a,r,s,c=$(l),d=c.parent();d.height(d.height()),n={lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-S":function(){f.doSave()},"Ctrl-Q":function(){f.doCancel()},"Ctrl-W":function(){f.doCancel()}}},f.trigger("Prepare",{node:l,editorObj:e,instance:void 0,opts:n}),t=e.fromTextArea(l,n),m.resolve(t),!(o=o||e.findModeByMIME(f.file.mime))&&(a=f.file.name.match(/.+\.([^.]+)$/))&&(o=e.findModeByExtension(a[1])),o&&(e.modeURL=u?"codemirror/mode/%N/%N.min":p+"/mode/%N/%N.min.js",r=o.mode,s=o.mime,t.setOption("mode",s),e.autoLoadMode(t,r),d.prev().children(".elfinder-dialog-title").append(" ("+s+("null"!=r?" : "+r:"")+")")),i=$(t.getWrapperElement()).css({padding:0,border:"none"}),c.data("cm",!0),i.height("100%"),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(f.fm.i18n("TextArea")).button().on("click",function(){c.data("cm")?(c.removeData("cm"),i.hide(),c.val(t.getValue()).show().trigger("focus"),$(this).text("CodeMirror")):(c.data("cm",!0),i.show(),t.setValue(c.hide().val()),t.refresh(),t.focus(),$(this).html(f.fm.i18n("TextArea")))})).prependTo(d.next())}),m},close:function(e,t){t&&t.toTextArea()},save:function(e,t){t&&$(e).data("cm")&&(e.value=t.getValue())},focus:function(e,t){t&&$(e).data("cm")&&t.focus()},resize:function(e,t,i,n){t&&t.refresh()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/editor-icons.png 0 -80"},exts:["md"],load:function(n){var s=this,e=this.fm,c=$(n).parent(),d=$.Deferred(),t=e.options.cdns.simplemde;return s.confObj.loader||(s.confObj.loader=$.Deferred(),s.fm.loadCss(t+"/simplemde.min.css"),u?require([t+"/simplemde.min.js"],function(e){s.confObj.loader.resolve(e)}):s.fm.loadScript([t+"/simplemde.min.js"],function(){s.confObj.loader.resolve(SimpleMDE)},{loadType:"tag"})),s.confObj.loader.done(function(e){var o,a,t,i=c.height(),r=c.outerHeight(!0)-i+14;n._setHeight=function(e){var t,i=e||c.height(),n=0;return c.children(".editor-toolbar,.editor-statusbar").each(function(){n+=$(this).outerHeight(!0)}),t=i-n-r,a.height(t),o.codemirror.refresh(),t},c.height(i),t={element:n,autofocus:!0},s.trigger("Prepare",{node:n,editorObj:e,instance:void 0,opts:t}),o=new e(t),d.resolve(o),(a=$(o.codemirror.getWrapperElement())).css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),n._setHeight(i)}),d},close:function(e,t){t&&t.toTextArea(),t=null},save:function(e,t){t&&(e.value=t.value())},focus:function(e,t){t&&t.codemirror.focus()},resize:function(e,t,i,n){t&&e._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/editor-icons.png 0 0"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.ckeditor?(this.ckeOpts={},e.extraOptions&&(this.ckeOpts=Object.assign({},e.extraOptions.ckeditor||{}),e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl))):this.disabled=!0},load:function(s){var c=this,d=this.fm,l=$.Deferred();return c.confObj.loader||(c.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=d.options.cdns.ckeditor+"/",$.getScript(d.options.cdns.ckeditor+"/ckeditor.js",function(){c.confObj.loader.resolve()})),c.confObj.loader.done(function(){var e,t=$(s).parent(),i=t.closest(".elfinder-dialog"),n=t.height(),o=/([&?]getfile=)[^&]+/,a=c.confObj.managerUrl||window.location.href.replace(/#.*$/,""),r="ckeditor";o.test(a)?a=a.replace(o,"$1"+r):a+="?getfile="+r,t.height(n),e={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:a,toolbarCanCollapse:!0,toolbarStartupExpanded:!d.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify,docprops",on:{instanceReady:function(e){var t=e.editor;t.resize("100%",n),i.one("beforedommove."+d.namespace,function(){t.destroy()}).one("dommove."+d.namespace,function(){c.load(s).done(function(e){c.instance=e})}),l.resolve(e.editor)}}},c.trigger("Prepare",{node:s,editorObj:CKEDITOR,instance:void 0,opts:e}),CKEDITOR.replace(s.id,Object.assign(e,c.confObj.ckeOpts)),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.definition.dialog;t.on("show",function(e){d.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)}),t.on("hide",function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)})})}),l},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&(e.value=t.getData())},focus:function(e,t){t&&t.focus()},resize:function(e,t,i,n){t&&"ready"===t.status&&t.resize("100%",$(e).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/editor-icons.png 0 -16"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(e,t){var i=this;t.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?(i.ckeOpts={},e.extraOptions&&(e.extraOptions.ckeditor5Mode&&(i.ckeditor5Mode=e.extraOptions.ckeditor5Mode),i.ckeOpts=Object.assign({},e.extraOptions.ckeditor5||{}),i.ckeOpts.mode&&(i.ckeditor5Mode=i.ckeOpts.mode,delete i.ckeOpts.mode),e.extraOptions.managerUrl&&(i.managerUrl=e.extraOptions.managerUrl))):i.disabled=!0,t.bind("destroy",function(){i.editor=null})},prepare:function(e,t,i){$(e).height(e.editor.fm.getUI().height()-100)},init:function(e,t,i,n){var o=i.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),a="",r="",s="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),o?(a=o[1],r=o[2],s=o[3]):r=i,this.data("data",{header:a,body:r,footer:s}),this._setupSelEncoding(i)},load:function(i){function t(e){var t,s=$(i).parent();s.height(c.getUI().height()-100),t=Object.assign({toolbar:["heading","|","fontSize","fontFamily","|","bold","italic","underline","strikethrough","highlight","|","alignment","|","numberedList","bulletedList","blockQuote","indent","outdent","|","ckfinder","link","imageUpload","insertTable","mediaEmbed","|","undo","redo"],language:a},o.confObj.ckeOpts),o.trigger("Prepare",{node:i,editorObj:e,instance:void 0,opts:t}),e.create(i,t).then(function(n){var o,a,e=n.commands.get("ckfinder"),t=n.plugins.get("FileRepository"),r={};!n.ui.view.toolbar||"classic"!==l&&"decoupled-document"!==l||$(i).closest(".elfinder-dialog").children(".ui-widget-header").append($(n.ui.view.toolbar.element).css({marginRight:"-1em",marginLeft:"-1em"})),"classic"===l&&$(i).closest(".elfinder-edit-editor").css("overflow","auto"),e&&(o=function(e){return e&&e.mime.match(/^image\//i)},a=function(e){if(n.commands.get("imageUpload").isEnabled)n.execute("imageInsert",{source:e});else{var t=n.plugins.get("Notification"),i=n.locale.t;t.showWarning(i("Could not insert image at the current position."),{title:i("Inserting image failed"),namespace:"ckfinder"})}},e.execute=function(){var t=s.closest(".elfinder-dialog"),e=c.getCommand("getfile"),i=function(){r.hasVar&&(t.off("resize close",i),e.callback=r.callback,e.options.folders=r.folders,e.options.multiple=r.multi,c.commandMap.open=r.open,r.hasVar=!1)};t.trigger("togleminimize").one("resize close",i),r.callback=e.callback,r.folders=e.options.folders,r.multi=e.options.multiple,r.open=c.commandMap.open,r.hasVar=!0,e.callback=function(e){var i=[];1!==e.length||"directory"!==e[0].mime?(c.getUI("cwd").trigger("unselectall"),$.each(e,function(e,t){o(t)?i.push(c.convAbsUrl(t.url)):n.execute("link",c.convAbsUrl(t.url))}),i.length&&a(i),t.trigger("togleminimize")):c.one("open",function(){c.commandMap.open="getfile"}).getCommand("open").exec(e[0].hash)},e.options.folders=!0,e.options.multiple=!0,c.commandMap.open="getfile",c.toast({mode:"info",msg:c.i18n("dblclickToSelect")})}),t.createUploadAdapter=function(e){return new p(e)},n.setData($(i).data("data").body),c.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":c.getMaximizeCss().zIndex+1}),d.resolve(n)}).catch(function(e){c.error(e)})}var n,e,o=this,c=this.fm,d=$.Deferred(),l=o.confObj.ckeditor5Mode||"decoupled-document",a=("zh"===(e=c.lang.toLowerCase().replace("_","-")).substr(0,2)&&"zh-cn"!==e&&(e="zh"),e),p=function(n){function o(e,t,i){c.exec("upload",{files:[e]},void 0,c.cwd().hash).done(function(e){e.added&&e.added.length?c.url(e.added[0].hash,{async:!0}).done(function(e){t({default:c.convAbsUrl(e)})}).fail(function(){i("errFileNotFound")}):i(c.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=c.parseError(e);i(c.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))}).progress(function(e){n.uploadTotal=e.total,n.uploaded=e.progress})}this.upload=function(){return new Promise(function(t,i){n.file instanceof Promise||n.file&&"function"==typeof n.file.then?n.file.then(function(e){o(e,t,i)}):o(n.file,t,i)})},this.abort=function(){c.getUI().trigger("uploadabort")}};return o.confObj.editor?t(o.confObj.editor):(n=$.Deferred(),o.fm.loadScript([c.options.cdns.ckeditor5+"/"+l+"/ckeditor.js"],function(t){t=t||(window.BalloonEditor||window.InlineEditor||window.ClassicEditor||window.DecoupledEditor),"en"!==c.lang?o.fm.loadScript([c.options.cdns.ckeditor5+"/"+l+"/translations/"+a+".js"],function(e){n.resolve(t)},{tryRequire:!0,loadType:"tag",error:function(e){a="en",n.resolve(t)}}):n.resolve(t)},{tryRequire:!0,loadType:"tag"}),n.done(function(e){o.confObj.editor=e,t(e)})),d},getContent:function(){var e=$(this).data("data");return e.header+e.body+e.footer},close:function(e,t){t&&t.destroy()},save:function(e,t){var i=$(e),n=i.data("data");t&&(n.body=t.getData(),i.data("data",n))},focus:function(e,t){$(e).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/editor-icons.png 0 -64"},exts:["htm","html","xhtml"],setup:function(e,t){var i=this;t.options.cdns.tinymce?(i.mceOpts={},e.extraOptions?(i.uploadOpts=Object.assign({},e.extraOptions.uploadOpts||{}),i.mceOpts=Object.assign({},e.extraOptions.tinymce||{})):i.uploadOpts={}):i.disabled=!0},load:function(l){var p=this,m=this.fm,f=$.Deferred();return p.confObj.loader||(p.confObj.loader=$.Deferred(),p.fm.loadScript([m.options.cdns.tinymce+(m.options.cdns.tinymce.match(/\.js/)?"":"/tinymce.min.js")],function(){p.confObj.loader.resolve()},{loadType:"tag"})),p.confObj.loader.done(function(){function s(){var e;tinymce.activeEditor.windowManager.windows?(e=tinymce.activeEditor.windowManager.windows[0],t=$(e?e.getEl():void 0).hide(),i=$("#mce-modal-block").hide()):t=$(".tox-dialog-wrap").hide()}function c(){i&&i.show(),t&&t.show()}var e,t,i,n=$(l).show().parent(),d=n.closest(".elfinder-dialog"),o=n.height(),a=n.outerHeight(!0)-o,r=tinymce.majorVersion;n.height(o),l._setHeight=function(e){if(r<5){var t,i=$(this).parent(),n=e||i.innerHeight(),o=0;i.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each(function(){o+=$(this).outerHeight(!0)}),t=n-o-a,i.find(".mce-edit-area iframe:first").height(t)}},e={selector:"#"+l.id,resize:!1,plugins:"print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat",image_advtab:!0,init_instance_callback:function(e){l._setHeight(o),d.one("beforedommove."+m.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,l.id)}).one("dommove."+m.namespace,function(){p.load(l).done(function(e){p.instance=e})}),f.resolve(e)},file_picker_callback:function(n,e,o){var t=m.getCommand("getfile"),i=function(){a.hasVar&&(t.callback=a.callback,t.options.folders=a.folders,t.options.multiple=a.multi,m.commandMap.open=a.open,a.hasVar=!1),d.off("resize close",i),c()},a={};return a.callback=t.callback,a.folders=t.options.folders,a.multi=t.options.multiple,a.open=m.commandMap.open,a.hasVar=!0,t.callback=function(e){var t,i;"directory"!==e.mime?(t=m.convAbsUrl(e.url),i=e.name+" ("+m.formatSize(e.size)+")","file"==o.filetype&&n(t,{text:i,title:i}),"image"==o.filetype&&n(t,{alt:i}),"media"==o.filetype&&n(t),d.trigger("togleminimize")):m.one("open",function(){m.commandMap.open="getfile"}).getCommand("open").exec(e.hash)},t.options.folders=!0,t.options.multiple=!1,m.commandMap.open="getfile",s(),d.trigger("togleminimize").one("resize close",i),m.toast({mode:"info",msg:m.i18n("dblclickToSelect")}),!1},images_upload_handler:function(e,t,i){var n=e.blob(),o=function(e){var t=e.data.dialog||{};(t.hasClass("elfinder-dialog-error")||t.hasClass("elfinder-confirm-upload"))&&(s(),t.trigger("togleminimize").one("resize close",a),m.unbind("dialogopened",o))},a=function(){d.off("resize close",a),c()},r=!0;n.name&&(r=void 0),m.bind("dialogopened",o).exec("upload",Object.assign({files:[n],clipdata:r},p.confObj.uploadOpts),void 0,m.cwd().hash).done(function(e){e.added&&e.added.length?m.url(e.added[0].hash,{async:!0}).done(function(e){c(),t(m.convAbsUrl(e))}).fail(function(){i(m.i18n("errFileNotFound"))}):i(m.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=m.parseError(e);t&&("errUnknownCmd"===t?t="errPerm":"userabort"===t&&(t="errAbort")),i(m.i18n(t||"errUploadNoFiles"))})}},5<=r&&(e.height="100%"),p.trigger("Prepare",{node:l,editorObj:tinymce,instance:void 0,opts:e}),tinymce.init(Object.assign(e,p.confObj.mceOpts))}),f},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,i,n){t&&e._setHeight()}},{info:{id:"zohoeditor",name:"Zoho Editor",iconImg:"img/editor-icons.png 0 -32",cmdCheck:"ZohoOffice",preventGet:!0,hideButtons:!0,syncInterval:15e3,canMakeEmpty:!0,integrate:{title:"Zoho Office API",link:"https://www.zoho.com/officeapi/"}},mimes:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/rtf","text/html","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","application/vnd.sun.xml.calc","text/csv","text/tab-separated-values","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.oasis.opendocument.presentation","application/vnd.sun.xml.impress"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.Mobile||t.UA.ltIE8)&&(this.disabled=!0)},prepare:function(e,t,i){var n=e.editor.fm.getUI();$(e).height(n.height()),t.width=Math.max(t.width||0,.8*n.width())},init:function(e,t,i,n){var o,a=this,r=$(this).hide(),s=n.getUI("toast"),c=$('<div class="elfinder-edit-spinner elfinder-edit-zohoeditor"/>').html('<span class="elfinder-spinner-text">'+n.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(r.parent());$(a).data("xhr",n.request({data:{cmd:"editor",name:a.editor.confObj.info.cmdCheck,method:"init","args[target]":t.hash,"args[lang]":n.lang,"args[cdata]":(o="",$.each(n.customData,function(e,t){o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),o)},preventDefault:!0}).done(function(e){var t;e.zohourl?(t={css:{height:"100%"}},a.editor.trigger("Prepare",{node:a,editorObj:void 0,instance:r,opts:t}),r.attr("src",e.zohourl).show().css(t.css),e.warning&&(s.appendTo(a.closest(".ui-dialog")),n.toast({msg:n.i18n(e.warning),mode:"warning",timeOut:0,onHidden:function(){1===s.children().length&&s.appendTo(n.getUI())},button:{text:"btnYes"}}))):(e.error&&n.error(e.error),a.elfinderdialog("destroy"))}).fail(function(e){e&&n.error(e),a.elfinderdialog("destroy")}).always(function(){c.remove()}))},load:function(){},getContent:function(){},save:function(){},beforeclose:function(e){var t,i=$(e),n=$.Deferred().always(function(){i.off("load",r)}),o="about:blank",a=function(){t=setTimeout(function(){var t;try{t=base.contentWindow.location.href}catch(e){t=null}t===o?n.resolve():0<--s?a():n.reject()},500)},r=function(){t&&clearTimeout(t),n.resolve()},s=20;return i.one("load",r),e.src=o,a(),n},close:function(e){this.fm;var t=$(e).data("xhr");"pending"===t.state()&&t.reject()}},{info:{id:"ziparchive",name:"btnMount",iconImg:"img/toolbar.png 0 -416",cmdCheck:"ZipArchive",edit:function(e,t){var i=this,n=$.Deferred();return i.request({data:{cmd:"netmount",protocol:"ziparchive",host:e.hash,path:e.phash},preventFail:!0,notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(e){var t;e.added&&e.added.length&&(e.added[0].phash&&(t=i.file(e.added[0].phash))&&(t.dirs||(t.dirs=1,i.change({changed:[t]}))),i.one("netmountdone",function(){i.exec("open",e.added[0].hash),i.one("opendone",function(){e.toast&&i.toast(e.toast)})})),n.resolve()}).fail(function(e){n.reject(e)}),n}},mimes:["application/zip"],load:function(){},save:function(){}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}}),e.setSelectionRange&&e.setSelectionRange(0,0),$(e).trigger("focus").show()},save:function(){}},{info:{id:"onlineconvert",name:"Online Convert",iconImg:"img/editor-icons.png 0 -144",cmdCheck:"OnlineConvert",preventGet:!0,hideButtons:!0,single:!0,converter:!0,canMakeEmpty:!1,integrate:{title:"ONLINE-CONVERT.COM",link:"https://online-convert.com"}},mimes:["*"],html:'<div style="width:100%;max-height:100%;"></div>',setup:function(e,t){var i=e.extraOptions.onlineConvert||{maxSize:100,showLink:!0};i.maxSize&&(this.info.maxSize=1048576*i.maxSize),this.set=Object.assign({url:"https://%s.online-convert.com%s?external_url=",conv:{Archive:{"7Z":{},BZ2:{ext:"bz"},GZ:{},ZIP:{}},Audio:{MP3:{},OGG:{ext:"oga"},WAV:{},WMA:{},AAC:{},AIFF:{ext:"aif"},FLAC:{},M4A:{},MMF:{},OPUS:{ext:"oga"}},Document:{DOC:{},DOCX:{},HTML:{},ODT:{},PDF:{},PPT:{},PPTX:{},RTF:{},SWF:{},TXT:{}},eBook:{AZW3:{ext:"azw"},ePub:{},FB2:{ext:"xml"},LIT:{},LRF:{},MOBI:{},PDB:{},PDF:{},"PDF-eBook":{ext:"pdf"},TCR:{}},Hash:{Adler32:{},"Apache-htpasswd":{},Blowfish:{},CRC32:{},CRC32B:{},Gost:{},Haval128:{},MD4:{},MD5:{},RIPEMD128:{},RIPEMD160:{},SHA1:{},SHA256:{},SHA384:{},SHA512:{},Snefru:{},"Std-DES":{},Tiger128:{},"Tiger128-calculator":{},"Tiger128-converter":{},Tiger160:{},Tiger192:{},Whirlpool:{}},Image:{BMP:{},EPS:{ext:"ai"},GIF:{},EXR:{},ICO:{},JPG:{},PNG:{},SVG:{},TGA:{},TIFF:{ext:"tif"},WBMP:{},WebP:{}},Video:{"3G2":{},"3GP":{},AVI:{},FLV:{},HLS:{ext:"m3u8"},MKV:{},MOV:{},MP4:{},"MPEG-1":{ext:"mpeg"},"MPEG-2":{ext:"mpeg"},OGG:{ext:"ogv"},OGV:{},WebM:{},WMV:{},Android:{link:"/convert-video-for-%s",ext:"mp4"},Blackberry:{link:"/convert-video-for-%s",ext:"mp4"},DPG:{link:"/convert-video-for-%s",ext:"avi"},iPad:{link:"/convert-video-for-%s",ext:"mp4"},iPhone:{link:"/convert-video-for-%s",ext:"mp4"},iPod:{link:"/convert-video-for-%s",ext:"mp4"},"Nintendo-3DS":{link:"/convert-video-for-%s",ext:"avi"},"Nintendo-DS":{link:"/convert-video-for-%s",ext:"avi"},PS3:{link:"/convert-video-for-%s",ext:"mp4"},Wii:{link:"/convert-video-for-%s",ext:"avi"},Xbox:{link:"/convert-video-for-%s",ext:"wmv"}}},catExts:{Hash:"txt"},link:'<div class="elfinder-edit-onlineconvert-link"><a href="https://www.online-convert.com" target="_blank"><span class="elfinder-button-icon"></span>ONLINE-CONVERT.COM</a></div>',useTabs:!(!$.fn.tabs||t.UA.iOS)},i)},prepare:function(e,t,i){var n=e.editor.fm.getUI();$(e).height(n.height()),t.width=Math.max(t.width||0,.8*n.width())},init:function(e,s,t,d){function c(e,t){var i;return r.catExts[e]?r.catExts[e]:r.conv[e]&&(i=r.conv[e][t])?(i.ext||t).toLowerCase():t.toLowerCase()}function i(t,i){var n,e;e=void 0===u.api?d.request({data:{cmd:"editor",name:"OnlineConvert",method:"init"},preventDefault:!0}):$.Deferred().resolve({api:u.api}),t=t.toLowerCase(),e.done(function(e){u.api=e.api,u.api&&(t?n="?category="+t:(n="",t="all"),u.conversions||(u.conversions={}),(u.conversions[t]?$.Deferred().resolve(u.conversions[t]):$.getJSON("https://api2.online-convert.com/conversions"+n)).done(function(e){u.conversions[t]=e,$.each(e,function(e,t){x[r.useTabs?"children":"find"](".onlineconvert-category-"+t.category).children(".onlineconvert-"+t.target).trigger("makeoption",t)}),i&&i()}))})}var n,o,l,p,m,f,a=this,u=a.editor.confObj,r=u.set,g=d.getUI("toast"),h={},v=d.uploadMimeCheck("application/zip",s.phash),b=$("base").length?document.location.href.replace(/#.*$/,""):"",x=(l=$("<div/>").on("click","button",function(){var e=$(this),t=e.data("opts")||null,i=e.closest(".onlineconvert-category").data("cname"),n=e.data("conv");!0===u.api&&j({category:i,convert:n,options:t})}).on("change",function(e){var t=$(e.target),i=t.parent(),n=t.closest(".elfinder-edit-onlineconvert-button").children("button:first"),o=n.data("opts")||{},a="boolean"===i.data("type")?t.is(":checked"):t.val();e.stopPropagation(),a&&("integer"===i.data("type")&&(a=parseInt(a)),i.data("pattern")&&(new RegExp(i.data("pattern")).test(a)||(requestAnimationFrame(function(){d.error('"'+d.escape(a)+'" is not match to "/'+d.escape(i.data("pattern"))+'/"')}),a=null)));a?o[t.parent().data("optkey")]=a:delete o[i.data("optkey")],n.data("opts",o)}),p=$("<ul/>"),m=+new Date,f=0,u.ext2mime||(u.ext2mime=Object.assign(d.arrayFlip(d.mimeTypes),D)),$.each(r.conv,function(o,e){var a=o.toLowerCase(),t="elfinder-edit-onlineconvert-"+a+m,r=$('<div id="'+t+'" class="onlineconvert-category onlineconvert-category-'+a+'"/>').data("cname",o);$.each(e,function(e,t){var i=e.toLowerCase(),n=c(o,e);u.ext2mime[n]||(u.ext2mime[n]="audio"===a||"image"===a||"video"===a?a+"/x-"+i:"application/octet-stream"),d.uploadMimeCheck(u.ext2mime[n],s.phash)&&r.append($('<div class="elfinder-edit-onlineconvert-button onlineconvert-'+i+'"/>').on("makeoption",function(e,t){var i=$(this);i.children(".elfinder-button-icon-preference").length||A.call(i,t)}).append($("<button/>").text(e).data("conv",e)))}),r.children().length&&(p.append($("<li/>").append($("<a/>").attr("href",b+"#"+t).text(o))),l.append(r),h[a]=f++)}),r.useTabs?l.prepend(p).tabs({beforeActivate:function(e,t){i(t.newPanel.data("cname"))}}):$.each(r.conv,function(e){var t=e.toLowerCase();l.append($('<fieldset class="onlineconvert-fieldset-'+t+'"/>').append($("<legend/>").text(e)).append(l.children(".onlineconvert-category-"+t)))}),l),y=$(this).append(x,r.showLink?$(r.link):null),w=$('<div class="elfinder-edit-spinner elfinder-edit-onlineconvert"/>').hide().html('<span class="elfinder-spinner-text">'+d.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(y.parent()),k=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(w),O=null,j=function(t){$(a).data("dfrd",(O?$.Deferred().resolve(O):(w.show(),d.forExternalUrl(s.hash,{progressBar:k}).done(function(e){O=e}).fail(function(e){e&&d.error(e),a.elfinderdialog("destroy")}).always(function(){w.hide()}))).done(function(e){y.fadeOut(),T({info:"Start conversion request."}),d.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[category]":t.category.toLowerCase(),"args[convert]":t.convert.toLowerCase(),"args[options]":JSON.stringify(t.options),"args[source]":d.convAbsUrl(e),"args[filename]":d.splitFileExtention(s.name)[0]+"."+c(t.category,t.convert),"args[mime]":s.mime},preventDefault:!0}).done(function(e){C(e.apires,t.category,t.convert)}).fail(function(e){e&&d.error(e),a.elfinderdialog("destroy")})}))},C=function(e,t,i){var n,o=[];e&&e.id?"failed"===(n=e.status).code?(w.hide(),e.errors&&e.errors.length&&$.each(e.errors,function(e,t){t.message&&o.push(t.message)}),d.error(o.length?o:n.info),y.fadeIn()):"completed"===n.code?M(e):(T(n),setTimeout(function(){I(e.id)},1e3)):(g.appendTo(a.closest(".ui-dialog")),e.message&&d.toast({msg:d.i18n(e.message),mode:"error",timeOut:5e3,onHidden:function(){1===g.children().length&&g.appendTo(d.getUI())}}),d.toast({msg:d.i18n("editorConvNoApi"),mode:"error",timeOut:3e3,onHidden:function(){1===g.children().length&&g.appendTo(d.getUI())}}),w.hide(),y.show())},T=function(e){w.show().children(".elfinder-spinner-text").text(e.info)},I=function(e){d.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[jobid]":e},preventDefault:!0}).done(function(e){C(e.apires)}).fail(function(e){e&&d.error(e),a.elfinderdialog("destroy")})},M=function(e){var t=e.output,i=(e.id,"");w.hide(),t&&t.length&&(a.elfinderdialog("destroy"),$.each(t,function(e,t){t.uri&&(i+=t.uri+"\n")}),d.upload({target:s.phash,files:[i],type:"text",extraData:{contentSaveId:"OnlineConvert-"+e.id}}))},E="document";function A(e){var i=this,t=$('<span class="elfinder-button-icon elfinder-button-icon-preference"/>').on("click",function(){n.toggle()}),n=$('<div class="elfinder-edit-onlinconvert-options"/>').hide();e.options&&$.each(e.options,function(e,t){"download_password"!==e&&n.append(function(e,t){var i,n,o,a=$("<p/>").data("optkey",e).data("type",t.type),r="",s="",c=!1;return t.description&&a.attr("title",d.i18n(t.description)),t.pattern&&a.data("pattern",t.pattern),a.append($("<span/>").text(d.i18n(e)+" : ")),"boolean"===t.type?((t.default||(c="allow_multiple_outputs"===e&&!v))&&(r=" checked",c&&(s=" disabled"),(i=(n=this.children("button:first")).data("opts")||{})[e]=!0,n.data("opts",i)),a.append($('<input type="checkbox" value="true"'+r+s+"/>"))):t.enum?(o=$("<select/>").append($('<option value=""/>').text("Select...")),$.each(t.enum,function(e,t){o.append($('<option value="'+t+'"/>').text(t))}),a.append(o)):a.append($('<input type="text" value=""/>')),a}.call(i,e,t))}),i.append(t,n)}y.parent().css({overflow:"auto"}).addClass("overflow-scrolling-touch"),(o=s.mime.match(/^(audio|image|video)/))&&(E=o[1]),r.useTabs?h[E]&&x.tabs("option","active",h[E]):(n=Object.keys(r.conv).length,$.each(r.conv,function(e){if(e.toLowerCase()===E)return i(e,function(){$.each(r.conv,function(e){e.toLowerCase()!==E&&i(e)})}),!1;n--}),n||$.each(r.conv,function(e){i(e)}),y.parent().scrollTop(x.children(".onlineconvert-fieldset-"+E).offset().top))},load:function(){},getContent:function(){},save:function(){},close:function(e){this.fm;var t=$(e).data("dfrd");t&&"pending"===t.state()&&t.reject()}}]},window.elFinder);